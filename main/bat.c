/**
 * @file bat.c
 * @author
 * @date
 * @brief
 */

//=============================================================================
// [Inclusions] ===============================================================
#include "driver/adc.h"

#include "bat.h"

//=============================================================================

//=============================================================================
// [Private Defines] ==========================================================
#define BAT_NUM_SAMPLES     16
#define BAT_CH              ADC1_CHANNEL_0

//=============================================================================

//=============================================================================
// [Local Typedef] ============================================================

//=============================================================================

//=============================================================================
// [External Data Definitions] ================================================

// Const ---------------------------------------------
//----------------------------------------------------

// Vars ----------------------------------------------
//----------------------------------------------------

// Task Handlers -------------------------------------
//----------------------------------------------------

// Queue Handlers ------------------------------------
//----------------------------------------------------

// Event Group Handlers ------------------------------
//----------------------------------------------------

// Semaphore Handlers --------------------------------
//----------------------------------------------------

//=============================================================================

//=============================================================================
// [Local Data Declarations] ==================================================

// Const ---------------------------------------------
//----------------------------------------------------

// Vars ----------------------------------------------
//----------------------------------------------------

// Task Handlers -------------------------------------
//----------------------------------------------------

// Queue Handlers ------------------------------------
//----------------------------------------------------

// Event Group Handlers ------------------------------
//----------------------------------------------------

// Semaphore Handlers --------------------------------
//----------------------------------------------------

//=============================================================================

//=============================================================================
// [Local Function Declarations] ==============================================

//=============================================================================

//=============================================================================
// [FreeRTOS Task Definitions] ================================================

//=============================================================================

//=============================================================================
// [Local Function Definitions] ===============================================

//=============================================================================

//=============================================================================
// [External Function Definition] =============================================

void bat_init(void)
{
    adc1_config_width(ADC_WIDTH_BIT_12);
    adc1_config_channel_atten(BAT_CH, ADC_ATTEN_DB_11);
}
// End void bat_init(void)


float_t bat_get_voltage(void)
{
    uint32_t adc_value = 0;

    for (uint8_t i = 0; i < BAT_NUM_SAMPLES; i++)
    {
        adc_value += adc1_get_raw(BAT_CH);
    }

    return (adc_value / BAT_NUM_SAMPLES) / 833.0;
}
// End float_t bat_get_voltage(void)

//=============================================================================

//====================== [End Document] =======================================
